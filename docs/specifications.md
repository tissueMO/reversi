# リバーシゲーム仕様書

## 概要

このプロジェクトはリバーシゲームです。  
プレイヤーは対戦相手と交互に手を打ち、より多くの石を自分の色に変えることを目指します。

## ゲームルール

1. 8×8 のマス目のボード上でプレイします
2. 黒と白の 2 種類の石を使用します
3. ゲームは黒石から開始します
4. 各プレイヤーは交互に石を置いていきます
5. 石は空いているマスに置く必要があります
6. 石は相手の石を挟むことで、挟まれた相手の石を自分の色に変えることができます
7. 少なくとも 1 つの石をひっくり返せる場所にのみ石を置くことができます
8. 石を置ける場所がない場合、相手のターンになります
9. 両プレイヤーとも石を置けなくなったらゲーム終了となります
10. ゲーム終了時、より多くの石を持っているプレイヤーが勝者です

## システム仕様

### 機能一覧

1. **ゲームボードの表示**

   - 8×8 のマス目で構成されたリバーシボード
   - 黒石と白石の表示
   - 石を置ける有効な場所のハイライト表示

2. **プレイヤー情報の表示**

   - プレイヤーと相手の現在の石の数（対戦モードに応じた表示名）
     - プレイヤー対プレイヤー：「プレイヤー 1」と「プレイヤー 2」
     - プレイヤー対 CPU：「あなた」と「CPU」
     - CPU 対 CPU：「CPU.1」と「CPU.2」
   - 現在の手番プレイヤーの表示（相手もしくはプレイヤーの石の数とアイコンのハイライトによって表現）
   - プレイヤーの色（黒/白）の表示
   - 初期スコアの表示（初期状態では黒と白がそれぞれ 2 つずつ）

3. **ゲームプレイ**

   - 石を置く操作
   - 石のひっくり返しアニメーション
   - ターン切り替え処理
   - 有効な手がない場合のスキップ処理

4. **ゲーム状態管理**

   - ゲームの初期化
   - ゲーム終了判定
   - 勝敗結果の表示
     - モーダルウィンドウで勝敗結果を表示
     - プレイヤーと相手の石の数をアイコンとともに表示
     - プレイヤー勝利時のクラッカーエフェクト演出
     - 「次のゲームへ」ボタンによる設定モーダル表示と新しいゲームの開始

5. **その他**
   - ゲームリセット機能（設定モーダルを開く）
   - **デバッグコンソール機能**
     - ブラウザの開発者ツールのコンソールから操作可能なデバッグ用 API
     - `window.__reversiDebug.skipToEndGame()` - ゲーム終了 2 手前までショートカット
     - `window.__reversiDebug.forceGameEnd()` - ゲームを強制終了
     - `window.__reversiDebug.setPlayer(playerNum)` - 手番プレイヤーを設定 (1:黒, 2:白)
   - **CPU 対戦機能**
     - プレイヤー対 CPU の対戦が可能
     - CPU 対 CPU 機能で自動対戦の観戦が可能
     - CPU の強さは 4 段階（初級、中級、上級、最強）から選択可能
     - CPU 対 CPU モードでは黒と白それぞれの CPU の強さを個別に設定可能
   - **CPU 戦略・ロジック**
     - **初級（Easy）**:
       - 完全にランダムな手を選択
       - 有効な手の中からランダムで配置位置を決定
       - 戦略的な思考は行わない
     - **中級（Medium）**:
       - 基本的な戦略を採用
       - 角の取得を最優先
       - 角に隣接する危険な位置は避ける
       - その他の場所では最も多くの石をひっくり返せる手を選択
     - **上級（Hard）**:
       - 高度な戦略的思考を実装
       - 盤面の各位置に重み付けを行い評価（角:100、角の隣:-30 など）
       - ゲーム終盤（残り 16 マス以下）では単純に石数最大化を目指す
       - 終盤以外では相手の有効手を減らす戦略も採用
       - 角・辺の取得を重視し、角の隣接マスを避ける高度な判断を行う
     - **最強（Ultimate）**:
       - TensorFlow.js を使用した学習済みのディープラーニングモデルを活用
       - 盤面状態を 3 チャンネルの入力として処理（自分の石、相手の石、空きマス）
       - モデルから得られた評価値に基づき最適な手を選択
       - モデル読み込みに失敗した場合は自動的に上級（Hard）難易度にフォールバック

### UI 仕様

1. **ボードデザイン**

   - 緑色のボード背景
   - 黒と白の石
   - 石を置ける位置は半透明の白い丸でハイライト

2. **情報表示**

   - 上部: 相手の石の数とアイコン
   - 下部: プレイヤーの石の数とアイコン

3. **操作性**

   - クリックで石を配置
   - アニメーション中は操作不可
   - 開発者ツールのコンソールからデバッグ操作が可能

4. **アニメーション**

   - 石のひっくり返しアニメーション（回転エフェクト）
   - 同心円状に広がるように時間差でアニメーション
   - プレイヤー勝利時のクラッカーアニメーション（画面中央から放出される紙吹雪効果）

5. **ゲーム結果表示**

   - モーダルウィンドウによる勝敗結果の表示（「あなたの勝ち！」「相手の勝ち！」「引き分け」）
   - プレイヤーと相手の石の数をアイコンとともに表示
   - 「次のゲームへ」ボタンクリックで設定モーダルを表示し、新しいゲームを設定可能
   - モーダル外側のクリックでは閉じない仕様（「次のゲームへ」ボタンのみで閉じる）
   - プレイヤー勝利時はモーダル表示と同時にクラッカーエフェクト演出

6. **ゲーム設定モーダル**
   - ゲーム開始前、リセットボタン押下時、ゲームクリア後の「次のゲームへ」ボタン押下時に表示
   - 対戦モードの選択
     - プレイヤー対プレイヤー
     - プレイヤー対 CPU
     - CPU 対 CPU
   - CPU 対戦モード選択時に CPU 強さを設定可能
     - プレイヤー対 CPU モード：「CPU.1 強さ」の設定（初級/中級/上級/最強）
     - CPU 対 CPU モード：「CPU.1 強さ」と「CPU.2 強さ」をそれぞれ個別に設定（初級/中級/上級/最強）
   - 「ゲームを開始」ボタンでゲームを開始

### 技術的な詳細

1. **TensorFlow.js を使用した AI**

   - 最強（Ultimate）モードでは TensorFlow.js を使用した学習済みモデルを活用
   - モデルは `/public/models/reversi_model/` ディレクトリに配置
   - CPU の判断能力を大幅に向上させ、高度な戦略的思考を実現
   - 初回読み込み時にウォームアップを行い、推論の安定性を確保
   - モデル読み込みに失敗した場合は自動的に上級モードにフォールバックする機能を実装

2. **レスポンシブ対応**

   - モバイルデバイス検出機能を実装
   - デバイスに応じたレイアウト調整（スコア表示の向き調整など）
   - モバイル向けに UI を最適化

3. **パフォーマンス最適化**
   - コンポーネントの再レンダリングを最小限に抑える設計
   - AI の思考処理を非同期で実行
   - TensorFlow.js のリソース管理を最適化（メモリリークの防止）
