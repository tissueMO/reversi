# リバーシゲーム仕様書

## 概要

このプロジェクトはリバーシゲームです。
プレイヤーは対戦相手と交互に手を打ち、より多くの石を自分の色に変えることを目指します。

## ゲームルール

1. 8×8 のマス目のボード上でプレイします
2. 黒と白の 2 種類の石を使用します
3. ゲームは黒石から開始します
4. 各プレイヤーは交互に石を置いていきます
5. 石は空いているマスに置く必要があります
6. 石は相手の石を挟むことで、挟まれた相手の石を自分の色に変えることができます
7. 少なくとも 1 つの石をひっくり返せる場所にのみ石を置くことができます
8. 石を置ける場所がない場合、相手のターンになります
9. 両プレイヤーとも石を置けなくなったらゲーム終了となります
10. ゲーム終了時、より多くの石を持っているプレイヤーが勝者です

## 画面一覧・画面仕様

### 1. ゲーム画面

- 8×8 のリバーシボード表示（緑色背景、黒石・白石）
- 石を置ける有効な場所は半透明の白丸でハイライト
- 上部：相手の石数とアイコン
- 下部：プレイヤーの石数とアイコン
- 現在の手番プレイヤーをハイライト
- 石のひっくり返しアニメーション（回転・同心円状に広がる）
- プレイヤー勝利時はクラッカー（紙吹雪）エフェクト
  - プレイヤー対プレイヤー:
    - ゲーム終了時、どちらかのプレイヤーが勝利した場合は常にクラッカーを表示
    - 引き分けの場合はクラッカーを表示しない
  - プレイヤー対 CPU:
    - ゲーム終了時、「あなた」が勝利した場合のみクラッカーを表示
    - CPU 勝利または引き分けの場合はクラッカーを表示しない
  - CPU 対 CPU
    - クラッカーは表示しない

### 2. ゲーム結果モーダル

- 勝敗結果（「あなたの勝ち！」「相手の勝ち！」「引き分け」）を表示
- プレイヤー・相手の石数とアイコンを表示
- 「次のゲームへ」ボタンで設定モーダルを表示
- モーダル外クリックでは閉じない

### 3. ゲーム設定モーダル

- ゲーム開始前、リセット時、ゲーム終了後に表示
- 対戦モード選択（プレイヤー対プレイヤー／プレイヤー対 CPU／CPU 対 CPU）
- CPU 対戦時は CPU 強さ（初級/中級/上級/最強）を選択
- CPU 対 CPU 時は黒・白それぞれの強さを個別設定 S
- 「ゲームを開始」ボタンで新規ゲーム開始

## 機能一覧・機能仕様

### 1. ゲームボード表示

- 8×8 のマス目、黒石・白石の表示
- 石を置ける有効な場所をハイライト

### 2. プレイヤー情報表示

- 石数、手番、色、初期スコア（黒 2・白 2）
- 対戦モードに応じた表示名（例：あなた/CPU、プレイヤー 1/2、CPU.1/2）

### 3. ゲームプレイ

- 石を置く操作（クリック）
- 石のひっくり返しアニメーション
- ターン切り替え
- 有効な手がない場合のスキップ

### 4. ゲーム状態管理

- ゲーム初期化
- ゲーム終了判定
- 勝敗結果の表示（モーダル、石数、アイコン、クラッカー演出）
- 「次のゲームへ」ボタンで設定モーダル表示・新規ゲーム開始

### 5. ゲームリセット

- 設定モーダルを開くことでリセット

### 6. デバッグコンソール機能

- window.\_\_reversiDebug.skipToEnding()：終了 2 手前まで進める
- window.\_\_reversiDebug.forceGameEnd()：強制終了
- window.\_\_reversiDebug.setPlayer(playerNum)：手番プレイヤーを設定（1:黒, 2:白）

### 7. CPU 対戦機能

- プレイヤー対 CPU、CPU 対 CPU に対応
- CPU 強さは 4 段階（初級/中級/上級/最強）
- CPU 対 CPU 時は黒・白の強さを個別設定

### 8. CPU 戦略・ロジック

- 初級（Easy）：有効な手からランダム選択
- 中級（Medium）：角優先、角隣接回避、最大ひっくり返し数優先
- 上級（Hard）：重み付け評価、終盤は石数最大化、相手の有効手減少戦略
- 最強（Ultimate）：TensorFlow.js による学習済みモデルで最適手選択。モデル読み込み失敗時は上級にフォールバック

## 非機能仕様

- **TensorFlow.js AI**：/public/models/reversi_model/ 配下のモデルを利用。初回読み込み時にウォームアップ。失敗時は上級に自動フォールバック
- **レスポンシブ対応**：モバイル検出・レイアウト調整・UI 最適化
- **パフォーマンス最適化**：再レンダリング最小化、AI 思考は非同期、TensorFlow.js リソース管理（メモリリーク防止）
